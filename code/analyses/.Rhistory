source("C:/Users/Batuhan/Desktop/action/code/analyses/data_processing.R")
source("C:/Users/Batuhan/Desktop/action/code/analyses/data_processing.R")
source("C:/Users/Batuhan/Desktop/action/code/analyses/experiment_analyses.R")
source("C:/Users/Batuhan/Desktop/action/code/analyses/model_analyses.R")
source("C:/Users/Batuhan/Desktop/action/code/analyses/model_comparison.R")
# Define the formulas outside the loop
formula_cf_trait <- bf(trait_causal_slider ~ 1 + mean_trait_counterfactual)
formula_heuristic_trait <- bf(trait_causal_slider ~ 1 + agent_type_factor*outcome_factor)
# Then use brm() directly inside the map call
# NB: This is more robust to session restarts
eval_trial_model_fits_trait = eval_trials %>%
filter(!is.na(trait_causal_slider)) %>%
group_by(game_id) %>%
nest() %>%
ungroup() %>%
mutate(fit_cf_trait = map(.x = data,
.f = ~ brm(formula = formula_cf_trait,
data = .x,
seed = 1)),
fit_heuristic_trait = map(.x = data,
.f = ~ brm(formula = formula_heuristic_trait,
data = .x,
seed = 1))) %>%
# ... the rest of your mutate call remains the same
mutate(fit_cf_trait = map(.x = fit_cf_trait,
.f = ~ add_criterion(.x, criterion = "loo", moment_match = TRUE)),
fit_heuristic_trait = map(.x = fit_heuristic_trait,
.f = ~ add_criterion(.x, criterion = "loo", moment_match = TRUE)),
model_comparison = pmap(.l = list(cf_trait = fit_cf_trait,
heuristic_trait = fit_heuristic_trait),
.f = ~ loo_compare(..1, ..2)),
best_model = map_chr(.x = model_comparison,
.f = ~ rownames(.) %>%
.[1]),
best_model = factor(best_model,
levels = c("..1", "..2"),
labels = c("cf_trait",
"heuristic_trait")))
# Define the formulas outside the loop
formula_cf_trait <- bf(trait_causal_slider ~ 1 + mean_trait_counterfactual)
